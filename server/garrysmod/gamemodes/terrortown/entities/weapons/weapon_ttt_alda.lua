if SERVER then
	resource.AddFile("weapons/mw19_m249/m249_fp.wav")
	resource.AddFile("weapons/mw19_m249/m249_suppressed_tp.wav")
	resource.AddFile("weapons/mw19_m249/rpk_boltback.wav" )
	resource.AddFile("weapons/mw19_m249/rpk_boltrelease.wav" )
	resource.AddFile("weapons/mw19_m249/m249_armmovement_01.wav" )
	resource.AddFile("weapons/mw19_m249/m249_armmovement_02.wav" )
	resource.AddFile("weapons/mw19_m249/m249_coveropen.wav" )
	resource.AddFile("weapons/mw19_m249/m249_coverclose.wav" )
	resource.AddFile("weapons/mw19_m249/m249_magout.wav" )
	resource.AddFile("weapons/mw19_m249/m249_magin.wav" )
	resource.AddFile("weapons/mw19_m249/m249_beltpullout.wav" )
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/eyes_coach.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/eyes_nick.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/generic_white.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/green.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/green2.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/green3.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/green4.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/hair_phongwrp.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/killy.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lightwarp_cel.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lightwarp_flesh.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lightwarp_hair.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lightwarp_t.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lightwarp_wet.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/lw_alu_3.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_001.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_002.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_003.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_004.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_005.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/metal_generic_006.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/normal_shared.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/phongwarp_flesh.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/phongwarp_hair2.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/phongwarp_soft.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/phongwarp2.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/skin_gradient.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/toon_generic.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/shared/toon_hair.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/tritium.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_acce.vmt")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_acce_col.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_acce_mask.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_acce_nml.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_body.vmt")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_body_col.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_body_mask.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_body_nml.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_mag.vmt")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_mag_col.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_mag_mask.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_mag_nml.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_muzzle.vmt")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_muzzle_col.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_muzzle_mask.vtf")
	resource.AddFile("materials/models/auditor/r6s/stuff/amelie/w_smg_alda_muzzle_nml.vtf")
	resource.AddFile("materials/models/drgorgon/weapons/utas/ameli_ammo.vmt")
	resource.AddFile("materials/models/drgorgon/weapons/utas/ameli_ammo.vtf")
	resource.AddFile("materials/models/drgorgon/weapons/utas/ameli_ammo_n.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/attachments/weapon_attachments_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/attachments/weapon_attachments_nm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/a_foregrip_01_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/a_foregrip_01_dm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/a_foregrip_01_nm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_ins_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_ins_dm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_ins_nm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_sec_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_sec_dm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/w_foregrip_sec_nm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_foregrip_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_foregrip_dm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_foregrip_nm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_w_carryhandle_dm.vmt")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_w_carryhandle_dm.vtf")
	resource.AddFile("materials/models/weapons/tfa_ins2/upgrades/weapon_w_carryhandle_nm.vtf")
	resource.AddFile("materials/models/drgorgon/glass_n.vtf")
	resource.AddFile("materials/entities/r6s_meatball.png")
	resource.AddFile("materials/vgui/ttt/icon_alda.vmt")
	resource.AddFile("models/weapons/fml/siege/c_alda_556.mdl")
	resource.AddWorkshop("2798983509")
end


SWEP.PrintName = "ALDA 5.56"
SWEP.Author = "Fleshy Mammal"
SWEP.Contact = ""
SWEP.Purpose = "lol fuck off"
SWEP.Instructions = ""

SWEP.Icon = "VGUI/ttt/icon_alda"
SWEP.Category = "TFA Rainbow Six Siege"

SWEP.Spawnable= true
SWEP.AdminSpawnable= true
SWEP.AdminOnly = false
SWEP.CSMuzzleFlashes = true

SWEP.MuzzleAttachment = 2
SWEP.ShellAttachment            = 2 		-- Should be "2" for CSS models or "shell" for hl2 models

SWEP.HoldType = "smg"
SWEP.ViewModelFOV = 70
SWEP.ViewModelFlip = false
SWEP.UseHands = true
SWEP.ViewModel = "models/weapons/fml/siege/c_alda_556.mdl"
SWEP.WorldModel = "models/weapons/fml/siege/c_alda_556.mdl"
SWEP.Slot				= 2				-- Slot in the weapon selection menu
SWEP.Kind 				= WEAPON_HEAVY
SWEP.ShowViewModel = true
SWEP.ShowWorldModel = true

SWEP.AutoSpawnable = true
SWEP.Spawnable             = true
SWEP.InLoadoutFor = { nil }
SWEP.CanBuy = {}
SWEP.AmmoEnt = "item_ammo_smg1_ttt"
SWEP.IsSilent = false

SWEP.WElements = {
	["Model"] = { type = "Model", model = "models/weapons/fml/siege/c_alda_556.mdl", bone = "ValveBiped.Bip01_R_Hand", pos = Vector(-3.5, 3.5, -5), angle = Angle(-10, 0, 180), size = Vector(1, 1, 1), color = Color(255, 255, 255, 255), surpresslightning = false, material = "", skin = 0, bodygroup = {[1] = 1} }
}

SWEP.ViewModelBoneMods = {
	["Weapon_Shell"] = { scale = Vector(1, 1, 1), pos = Vector(0, 0, 0), angle = Angle(0, 135, 0) },	
	["Weapon_Muzzle"] = { scale = Vector(1, 1, 1), pos = Vector(3, -2.7, -7), angle = Angle(180, 180, 0) },	
}

SWEP.IronSightsPos = Vector(-2.37, -5, 0.004)
SWEP.IronSightsAng = Vector(0, 0, 0)
SWEP.VMPos = Vector(0.5, 5, -0.75)
SWEP.VMAng = Vector(0,0,0)
SWEP.VMPos_Additive = false --Set to false for an easier time using VMPos. If true, VMPos will act as a constant delta ON TOP OF ironsights, run, whateverelse

SWEP.Attachments = {
	[1] = { offset = { 0, 0 }, atts = { "ins2_br_supp", "r6s_h_barrel", "r6s_muzzle_2", "r6s_flashhider_2" }, order = 1 },
	[2] = { offset = { 0, 0 }, atts = { "ins2_si_kobra", "ins2_si_eotech", "ins2_si_rds", "ins2_si_2xrds", "ins2_si_c79" }, order = 2 },
	[3] = { offset = { 0, 0 }, atts = { "am_ap", "am_hp" }, order = 3 },
	[4] = { offset = { 0, 0 }, atts = { "ins2_ub_laser" }, order = 4 },		
	[5] = { offset = { 0, 0 }, atts = { "r6s_fml_alda_pre_nerf" }, order = 5 },		
}

SWEP.RTOpaque	= true

SWEP.SequenceRateOverride = {
	[ACT_VM_RELOAD] = 1,	
}

SWEP.LaserSightModAttachment = 1

SWEP.Type = "Light Machine Gun"

SWEP.AutoSwitchTo = true
SWEP.AutoSwitchFrom = true

SWEP.UseHands = true

SWEP.FiresUnderwater = true

SWEP.DrawCrosshair = false

SWEP.DrawAmmo = true

SWEP.ReloadSound = ""

SWEP.Base = "weapon_tttbase"

--Recoil Related
SWEP.Primary.KickUp = 0.35 -- This is the maximum upwards recoil (rise)
SWEP.Primary.KickHorizontal = 0.075
SWEP.Primary.StaticRecoilFactor = 0.5 --Amount of recoil to directly apply to EyeAngles.  Enter what fraction or percentage (in decimal form) you want.  This is also affected by a convar that defaults to 0.5.

SWEP.CrouchAccuracyMultiplier = 0.75 --Less is more.  Accuracy * 0.5 = Twice as accurate, Accuracy * 0.1 = Ten times as accurate

-- Selective Fire Stuff

SWEP.Primary.Sound = Sound("weapons/mw19_m249/m249_suppressed_tp.wav")
SWEP.Primary.Damage = 14
SWEP.Primary.TakeAmmo = 1
SWEP.Primary.ClipSize = 80
SWEP.Primary.Ammo = "SMG1"
SWEP.Primary.DefaultClip = 80 + 80 * 2
SWEP.Primary.Automatic = true
SWEP.Primary.Recoil = 1
SWEP.Primary.Delay = 0.09
SWEP.Primary.Cone = 0.06
SWEP.Primary.SavedCone = 0.06
SWEP.Primary.Force = 1
SWEP.TempClip = 0
SWEP.HeadshotMultiplier  = 2
SWEP.WeaponTimer = 0

SWEP.Primary.PenetrationMultiplier = 2 --Change the amount of something this gun can penetrate through

SWEP.Secondary.ClipSize = 0
SWEP.Secondary.DefaultClip = 0
SWEP.Secondary.Automatic = false
SWEP.Secondary.Ammo = "none"

SWEP.Secondary.IronFOV = 90

--[[INSPECTION]]--
SWEP.InspectPos = Vector(7.32, 5, -0.84)
SWEP.InspectAng = Vector(13.536, 20.951, 13.949)

--[[SPRINTING]]--
SWEP.RunSightsPos = Vector(1.559, 5, -1.13)
SWEP.RunSightsAng = Vector(-24.535, 23.375, -25.553)

SWEP.SpeedBoost = .75
SWEP.Reloaded = false
SWEP.SpeedBoostRemoved = false
SWEP.DamageType            = "Impact"
SWEP.HealthBoost = 1.25

sound.Add({
	name = 			"Weapon_FML_ALDA556.Pew",
	channel = 		CHAN_USER_BASE+10,
	volume = 		1.0,
	sound = 			"weapons/mw19_m249/m249_fp.wav" 
})
  
  sound.Add({
	name = 			"Weapon_FML_ALDA.Bolt1",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/rpk_boltback.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.Bolt2",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/rpk_boltrelease.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.Foley1",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_armmovement_01.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.Open",
	channel = 		CHAN_USER_BASE+10,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_coveropen.wav" 
})
  
  sound.Add({
	name = 			"Weapon_FML_ALDA.Close",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_coverclose.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.Out",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_magout.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.In",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_magin.wav" 
})

sound.Add({
	name = 			"Weapon_FML_ALDA.Belt",
	channel = 		CHAN_ITEM,
	volume = 		0.4,
	sound = 			"weapons/mw19_m249/m249_beltpullout.wav" 
})

function SWEP:PreDrop()
   return self.BaseClass.PreDrop( self )
end

function SWEP:OnDrop()
	if SERVER then
		local mins, maxs = self:GetModelBounds()
		mins:Mul(0.5)
		maxs:Mul(0.5)
		
		local result = self:PhysicsInitBox(mins, maxs, "solidmetal")
		--[[
		local phys = self:GetPhysicsObject()
		phys:Wake()
		print(phys)
		print("their malevolent nasty angles: " .. tostring(phys:GetAngles()) .. "\nour beautiful perfect angles: " .. tostring(self:GetAngles()))
		phys:SetAngles(self:GetAngles())
		print("their malevolent nasty angles (changed): " .. tostring(phys:GetAngles()) .. "\nour beautiful perfect angles: " .. tostring(self:GetAngles()))
		]]--
	end
end

if CLIENT then
	local WorldModel = ClientsideModel(SWEP.WorldModel)

	-- Settings...
	WorldModel:SetSkin(1)
	WorldModel:SetNoDraw(true)

	function SWEP:DrawWorldModel()
		local _Owner = self:GetOwner()

		if (IsValid(_Owner)) then
            -- Specify a good position
			local offsetVec = Vector(3, -2.7, -7)
			local offsetAng = Angle(180, 180, 0)
			
			local boneid = _Owner:LookupBone("ValveBiped.Bip01_R_Hand") -- Right Hand
			if !boneid then return end

			local matrix = _Owner:GetBoneMatrix(boneid)
			if !matrix then return end

			local newPos, newAng = LocalToWorld(offsetVec, offsetAng, matrix:GetTranslation(), matrix:GetAngles())

			WorldModel:SetPos(newPos)
			WorldModel:SetAngles(newAng)

            WorldModel:SetupBones()
		else
			WorldModel:SetPos(self:GetPos())
			WorldModel:SetAngles(self:GetAngles())
		end

		WorldModel:DrawModel()
	end
end

function SWEP:ShootEffects()
	self:SendWeaponAnim( ACT_VM_PRIMARYATTACK )
	self.Owner:SetAnimation( PLAYER_ATTACK1 )
end

function SWEP:GetPrimaryCone()
	local cone = self.Primary.Cone or 0.2
	if self.Owner:Crouching() then
		cone = cone * 0.5
	end
	-- 15% accuracy bonus when sighting
	return self:GetIronsights() and (cone * 0.85) or cone
end


function SWEP:Holster()
	if IsValid(self.Owner) and self.Owner:IsPlayer() then
		if self.SpeedBoostRemoved == false then
			self.Owner:SetWalkSpeed(self.Owner:GetWalkSpeed() / self.SpeedBoost)
			if self.Owner:Health() > self.HealthBoost then
				self.Owner:SetHealth(self.Owner:Health() / self.HealthBoost)
				if server then
					self.Owner:SetMaxHealth(100)
				end
			end
		end
	end
	return true
end

function SWEP:Deploy()
	if IsValid(self.Owner) and self.Owner:IsPlayer() then
		if (self:Clip1() >= 1) then
			self.Owner:SetWalkSpeed(self.Owner:GetWalkSpeed() * self.SpeedBoost)
			if server then
				self.Owner:SetMaxHealth(125)
			end
			if self.Owner:Health() > 5 then
				self.Owner:SetHealth(self.Owner:Health() * self.HealthBoost)
			end
		end
	end
end

function SWEP:Think()
	if ((self:Clip1() <= 1) and self.Reloaded == false) then
		if self.SpeedBoostRemoved == false then
			self.Owner:SetWalkSpeed(self.Owner:GetWalkSpeed() / self.SpeedBoost)
			if server then
				self.Owner:SetMaxHealth(100)
			end
			if self.Owner:Health() > self.HealthBoost then
				self.Owner:SetHealth(self.Owner:Health() / self.HealthBoost)
			end
			self.SpeedBoostRemoved = true
		end
	end
end

hook.Add("TTTPrepareRound", "ResetAlda", function()
	if SERVER then
	   local rf = RecipientFilter()
	   rf:AddAllPlayers()
	   players = rf:GetPlayers()
	   for i = 1, #players do
		  players[i]:SetWalkSpeed(220)
		  players[i]:SetHealth(100)
		  players[i]:SetMaxHealth(100)
	   end
	end
end)

hook.Add("TTTBeginRound", "AldaStartingHealth", function()
	for _, ply in ipairs( player.GetAll() ) do
		if !IsValid(ply:GetActiveWeapon()) or !IsValid(ply) then
			continue
      	end
		if ply:GetActiveWeapon():GetClass() == "weapon_ttt_alda" then
			ply:SetHealth(125)
		end
	end
end)

